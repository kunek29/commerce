{% extends "auctions/layout.html" %}

{% block title %}
Listing Page
{% endblock %}

{% block body %}
    
    {% if listing.status == False and user == price.bidder %}
        <h2>Congratulations, You won!</div>
    {% elif listing.status == False and user != price.bidder %}
        <h2>Auction closed!</div>
    {% endif %}
    
    {% if user == listing.seller and listing.status == True %}
        <form class="close-auction" action="{% url 'listing_page' listing.id %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="close_form">
            <input type="submit" value="Close Auction">
        </form>
    {% endif %}
    
    <div class="listing-page-top-container">
        <div class="listing-page-top-container-left">
            <img src="{{ listing.image_url }}">
        </div>
        <div class="listing-page-top-container-right">
            <h2>{{ listing.title }}</h2>
            <div> Posted: {{ listing.date }}</div>
    
            {% if price and listing.status == True %}
                <div> Current Price: <strong>{{ price.amount }}$</strong></div>
            {% elif price and listing.status == False %}
                <div>Sold for: {{ price.amount }}$</div>
            {% else %}
                <div> Minimum price: {{ listing.min_bid }}</div>
                <div> Current Price: No offers yet</div>
            {% endif %}

            {% if user.is_authenticated and listing.status == True %}
                <form action="{% url 'listing_page' listing.id %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="bid_form">
                    <input type="number" step="0.01" name="new_bid" placeholder="Enter amount">
                    <input type="submit" value="Place Bid">
                </form>
                {% if watched_listing %}
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="watchlist_form_remove">
                    <input class="watchlist-button" type="submit" value="Remove from watchlist">
                </form>
                {% else %}
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="watchlist_form_add">
                    <input class="watchlist-button" type="submit" value="Add to watchlist">
                </form>
                {% endif %}
    
            {% elif not user.is_authenticated and listing.status == True %}
                <div>Log In to Bid or Comment!</div>
            {% endif %}
        </div>
    </div>
    <div class="listing-details">Listing details</div>
    <table class="listing-details-container">   
        <tr class="listing-details-container-row">
            <td class="table-left-column">Description:</td>
            <td class="table-right-column" id="listing-description">{{ listing.description }}</td>
        <tr class="listing-details-container-row">
            <td class="table-left-column">Posted by:</td>
            <td class="table-right-column">{{ listing.seller }}</td>
        </tr>
        <tr class="listing-details-container-row">
            <td class="table-left-column">Category:</td> 
            <td class="table-right-column">{{ listing.category }}</td>
        </tr>
    </table>

    <div class="listing-comments">Comments</div>
    
        {% for comment in comments %}
            <div class="listing-comments-container">
                <div class="comment-info">User: {{ comment.user }}</div>
                <div class="comment-info">{{ comment.date }}</div>
                <div class="comment">{{ comment.comment }}</div>
            </div> 
        {% endfor %}
     
        {% if user.is_authenticated and listing.status == True %}
            <form class="comments-form" action="{% url 'listing_page' listing.id %}" method="post">
                {% csrf_token %}
                {{ comment_f }}
                <input type="hidden" name="form_type" value="comment_form">
                <input type="submit" value="Post">
            </form>
        {% endif %}
    
{% endblock %}